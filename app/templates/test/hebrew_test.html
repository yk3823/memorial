<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×ª×›×•× ×•×ª ×¢×‘×¨×™×•×ª - ××ª×¨ ×–×™×›×¨×•×Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/hebrew_rtl.css') }}">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Noto Sans Hebrew', 'Arial Hebrew', Arial, sans-serif;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-right: 4px solid #4A90E2;
        }
        
        .test-title {
            font-size: 24px;
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495E;
        }
        
        .hebrew-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #E8F4FD;
            border-radius: 8px;
            font-size: 18px;
            font-family: 'Noto Sans Hebrew', 'Arial Hebrew', Arial, sans-serif;
            direction: rtl;
            text-align: right;
        }
        
        .hebrew-input:focus {
            border-color: #4A90E2;
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .btn {
            background: #4A90E2;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Noto Sans Hebrew', 'Arial Hebrew', Arial, sans-serif;
            margin: 5px;
        }
        
        .btn:hover {
            background: #357ABD;
        }
        
        .results {
            background: #F8F9FA;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            min-height: 100px;
        }
        
        .verse-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-right: 3px solid #E8F4FD;
        }
        
        .verse-hebrew {
            font-size: 20px;
            font-weight: bold;
            color: #2C3E50;
            line-height: 1.8;
            margin-bottom: 8px;
        }
        
        .verse-english {
            color: #666;
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .verse-reference {
            font-size: 14px;
            color: #4A90E2;
            font-weight: bold;
        }
        
        .letter-display {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: #4A90E2;
            color: white;
            border-radius: 50%;
            font-size: 18px;
            font-weight: bold;
            margin: 5px;
        }
        
        .alphabet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .letter-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #E8F4FD;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .letter-card:hover {
            border-color: #4A90E2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .letter-hebrew {
            font-size: 24px;
            font-weight: bold;
            color: #2C3E50;
            margin-bottom: 5px;
        }
        
        .letter-name {
            font-size: 14px;
            color: #666;
        }
        
        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
        }
        
        .status.success {
            background: #D4EDDA;
            color: #155724;
        }
        
        .status.error {
            background: #F8D7DA;
            color: #721C24;
        }
        
        .status.info {
            background: #D1ECF1;
            color: #0C5460;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4A90E2;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header>
            <h1 class="main-title">ğŸ§ª ×‘×“×™×§×ª ×ª×›×•× ×•×ª ×¢×‘×¨×™×•×ª</h1>
            <p class="main-subtitle">×‘×“×™×§×” ××§×™×¤×” ×©×œ ×›×œ ×”×ª×›×•× ×•×ª ×”×¢×‘×¨×™×•×ª ×‘××ª×¨ ×”×–×™×›×¨×•×Ÿ</p>
        </header>

        <!-- Hebrew Name Analysis Test -->
        <div class="test-section">
            <h2 class="test-title">
                <span>ğŸ“</span>
                ×‘×“×™×§×ª × ×™×ª×•×— ×©××•×ª ×¢×‘×¨×™×™×
            </h2>
            <p class="test-description">
                ×”×–×Ÿ ×©× ×¢×‘×¨×™ ×›×“×™ ×œ×‘×“×•×§ ××ª ××œ×’×•×¨×™×ª× × ×™×ª×•×— ×”×©××•×ª. ×”××¢×¨×›×ª ×ª×¤×¨×§ ××ª ×”×©× ×œ××•×ª×™×•×ª ×•×ª×¦×™×’ ××™×“×¢ ×¢×œ ×›×œ ××•×ª.
            </p>
            
            <div class="input-group">
                <label for="hebrewName">×©× ×¢×‘×¨×™ ×œ×‘×“×™×§×”:</label>
                <input type="text" id="hebrewName" class="hebrew-input" placeholder="×œ×“×•×’××”: ×™×•×¡×£, ××¨×™×, ××‘×¨×”×">
            </div>
            
            <button class="btn" onclick="analyzeHebrewName()">× ×ª×— ×©× ×¢×‘×¨×™</button>
            <button class="btn" onclick="testCommonNames()">×‘×“×•×§ ×©××•×ª × ×¤×•×¦×™×</button>
            
            <div id="nameAnalysisResults" class="results"></div>
        </div>

        <!-- MAIN ENGINE TEST -->
        <div class="test-section">
            <h2 class="test-title">
                <span>ğŸ¯</span>
                ×”×× ×•×¢ ×”×¨××©×™ - ×¤×¡×•×§×™× ××œ××™× ×œ×–×™×›×¨×•×Ÿ
            </h2>
            <p class="test-description">
                <strong>×–×”×• ×”×× ×•×¢ ×”×¨××©×™ ×©×œ ×”××ª×¨!</strong><br>
                ×¢×‘×•×¨ ×©× ×›××• "×™×•×¡×£" ×”××¢×¨×›×ª ×ª×¦×™×’ ×‘×¡×“×¨:<br>
                1. ×›×œ 8 ×”×¤×¡×•×§×™× ×©×œ ×”××•×ª ×™ (×¤×¡×•×§×™× 73-80)<br>
                2. ×›×œ 8 ×”×¤×¡×•×§×™× ×©×œ ×”××•×ª ×• (×¤×¡×•×§×™× 41-48)<br>  
                3. ×›×œ 8 ×”×¤×¡×•×§×™× ×©×œ ×”××•×ª ×¡ (×¤×¡×•×§×™× 113-120)<br>
                4. ×›×œ 8 ×”×¤×¡×•×§×™× ×©×œ ×”××•×ª ×£/×¤ (×¤×¡×•×§×™× 129-136)<br>
                5. ××—×¨ ×›×š ×›×œ ×¤×¡×•×§×™ × ×©××”: × ,×©,×,×”
            </p>
            
            <div class="input-group">
                <label for="memorialName">×©× ×¢×‘×¨×™ ×œ×–×™×›×¨×•×Ÿ:</label>
                <input type="text" id="memorialName" class="hebrew-input" placeholder="×”×–×Ÿ ×©× ×¢×‘×¨×™ (×œ×“×•×’××”: ×™×•×¡×£, ××¨×™×, ××‘×¨×”×)">
            </div>
            
            <button class="btn" onclick="generateMemorialVerses()">ğŸ•¯ï¸ ×¦×•×¨ ×¤×¡×•×§×™ ×–×™×›×¨×•×Ÿ ××œ××™×</button>
            <button class="btn" onclick="testCommonMemorialNames()">ğŸ‘¥ ×‘×“×•×§ ×©××•×ª × ×¤×•×¦×™×</button>
            
            <div id="memorialVersesResults" class="results"></div>
        </div>

        <!-- Verse Selection Test (Legacy) -->
        <div class="test-section">
            <h2 class="test-title">
                <span>ğŸ“œ</span>
                ×‘×“×™×§×ª ×‘×—×™×¨×ª ×¤×¡×•×§×™× (×‘×—×™×¨×” ×—×œ×§×™×ª)
            </h2>
            <p class="test-description">
                ×‘×“×™×§×ª ×‘×—×™×¨×ª ×¤×¡×•×§×™× ××•×’×‘×œ×ª (×œ× ×›×œ ×”×¤×¡×•×§×™×) ×¢× ×©×™×˜×•×ª ×©×•× ×•×ª.
            </p>
            
            <div class="input-group">
                <label for="nameForVerses">×©× ×¢×‘×¨×™ ×œ×‘×—×™×¨×ª ×¤×¡×•×§×™×:</label>
                <input type="text" id="nameForVerses" class="hebrew-input" placeholder="×”×–×Ÿ ×©× ×¢×‘×¨×™">
            </div>
            
            <div class="input-group">
                <label for="versesPerLetter">××¡×¤×¨ ×¤×¡×•×§×™× ×œ×›×œ ××•×ª:</label>
                <select id="versesPerLetter" class="hebrew-input" style="width: auto;">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="selectionMethod">×©×™×˜×ª ×‘×—×™×¨×”:</label>
                <select id="selectionMethod" class="hebrew-input" style="width: auto;">
                    <option value="balanced">×××•×–×Ÿ</option>
                    <option value="sequential">×¨×¦×™×£</option>
                    <option value="random">××§×¨××™</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>
                    <input type="checkbox" id="includeNeshama" checked> 
                    ×”×•×¡×£ ×¤×¡×•×§×™ × ×©××”
                </label>
            </div>
            
            <button class="btn" onclick="selectVerses()">×‘×—×¨ ×¤×¡×•×§×™×</button>
            <button class="btn" onclick="testMultipleMethods()">×‘×“×•×§ ×›×œ ×”×©×™×˜×•×ª</button>
            
            <div id="verseSelectionResults" class="results"></div>
        </div>

        <!-- Hebrew Alphabet Display Test -->
        <div class="test-section">
            <h2 class="test-title">
                <span>ğŸ”¤</span>
                ×‘×“×™×§×ª ×ª×¦×•×’×ª ×”××œ×¤×‘×™×ª ×”×¢×‘×¨×™
            </h2>
            <p class="test-description">
                ×”×¦×’×ª ×›×œ 22 ×”××•×ª×™×•×ª ×”×¢×‘×¨×™×•×ª ×¢× ×”××™×“×¢ ×”×¨×œ×•×•× ×˜×™ ××‘×¡×™×¡ ×”× ×ª×•× ×™×.
            </p>
            
            <button class="btn" onclick="loadHebrewAlphabet()">×˜×¢×Ÿ ××œ×¤×‘×™×ª ×¢×‘×¨×™</button>
            <button class="btn" onclick="loadAlphabetWithVerses()">×˜×¢×Ÿ ×¢× ×¤×¡×•×§×™× ×œ×“×•×’××”</button>
            
            <div id="alphabetResults" class="results"></div>
        </div>

        <!-- Hebrew Search Test -->
        <div class="test-section">
            <h2 class="test-title">
                <span>ğŸ”</span>
                ×‘×“×™×§×ª ×—×™×¤×•×© ×¢×‘×¨×™
            </h2>
            <p class="test-description">
                ×‘×“×™×§×ª ×× ×•×¢ ×”×—×™×¤×•×© ×”×¢×‘×¨×™ ×©××—×¤×© ×‘×¤×¡×•×§×™×, ××•×ª×™×•×ª ×•××–×›×¨×•×ª.
            </p>
            
            <div class="input-group">
                <label for="searchQuery">×©××™×œ×ª×ª ×—×™×¤×•×©:</label>
                <input type="text" id="searchQuery" class="hebrew-input" placeholder="×—×¤×© ×‘×¢×‘×¨×™×ª...">
            </div>
            
            <div class="input-group">
                <label for="searchType">×¡×•×’ ×—×™×¤×•×©:</label>
                <select id="searchType" class="hebrew-input" style="width: auto;">
                    <option value="all">×”×›×œ</option>
                    <option value="verses">×¤×¡×•×§×™×</option>
                    <option value="letters">××•×ª×™×•×ª</option>
                    <option value="memorials">××–×›×¨×•×ª</option>
                </select>
            </div>
            
            <button class="btn" onclick="searchHebrew()">×—×¤×©</button>
            <button class="btn" onclick="testSearchSamples()">×‘×“×•×§ ×“×•×’×××•×ª ×—×™×¤×•×©</button>
            
            <div id="searchResults" class="results"></div>
        </div>

        <!-- RTL Layout Test -->
        <div class="test-section">
            <h2 class="test-title">
                <span>â†©ï¸</span>
                ×‘×“×™×§×ª ×¤×¨×™×¡×” ××™××™×Ÿ ×œ×©×××œ (RTL)
            </h2>
            <p class="test-description">
                ×‘×“×™×§×ª ×”×ª×¦×•×’×” ×”× ×›×•× ×” ×©×œ ×˜×§×¡×˜ ×¢×‘×¨×™ ×•×›×™×•×•×Ÿ ×”×¤×¨×™×¡×”.
            </p>
            
            <div style="border: 2px dashed #4A90E2; padding: 15px; margin: 10px 0;">
                <h3>×‘×“×™×§×ª ×›×™×•×•×Ÿ ×˜×§×¡×˜ ×¢×‘×¨×™:</h3>
                <p class="verse-hebrew">×Ö·×©Ö°××¨Öµ×™ ×ªÖ°×Ö´×™×Öµ×™Ö¾×“Ö¸×¨Ö¶×šÖ° ×”Ö·×”Ö¹×œÖ°×›Ö´×™× ×‘Ö°Ö¼×ª×•Ö¹×¨Ö·×ª ×™Ö°×”×•Ö¸×”</p>
                <p class="verse-english">Blessed are those whose way is blameless, who walk in the law of the LORD</p>
                
                <h4>×‘×“×™×§×ª ××¡×¤×¨×™× ×¢×‘×¨×™×™×:</h4>
                <p>×¤×¡×•×§ ××¡×¤×¨ <!---->123<!---->: ×ª×”×™×œ×™× ×§×™×˜:×</p>
                
                <h4>×‘×“×™×§×ª ×¢×¨×‘×•×‘ ×¢×‘×¨×™×ª-×× ×’×œ×™×ª:</h4>
                <p>×”×©× John ×‘×¢×‘×¨×™×ª ×™×›×ª×‘ ×™×•×—× ×Ÿ ××• ×’'×•×Ÿ</p>
            </div>
            
            <button class="btn" onclick="testRTLLayout()">×‘×“×•×§ ×¤×¨×™×¡×ª RTL</button>
            
            <div id="rtlResults" class="results"></div>
        </div>

        <!-- API Health Test -->
        <div class="test-section">
            <h2 class="test-title">
                <span>ğŸ¥</span>
                ×‘×“×™×§×ª ×‘×¨×™××•×ª API
            </h2>
            <p class="test-description">
                ×‘×“×™×§×” ×©×›×œ ×”-API endpoints ×”×¢×‘×¨×™×™× ×¤×•×¢×œ×™× ×›×¨××•×™.
            </p>
            
            <button class="btn" onclick="checkAPIHealth()">×‘×“×•×§ ×‘×¨×™××•×ª API</button>
            <button class="btn" onclick="runFullAPITest()">×‘×“×™×§×” ××§×™×¤×” ×©×œ API</button>
            
            <div id="apiHealthResults" class="results"></div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>×˜×•×¢×Ÿ...</p>
        </div>
    </div>

    <script>
        // Global variables
        let apiBaseUrl = '/api/v1';
        
        // Show/hide loading
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // Display results helper
        function displayResults(containerId, content) {
            document.getElementById(containerId).innerHTML = content;
        }
        
        // API call helper
        async function apiCall(endpoint, options = {}) {
            try {
                showLoading();
                const response = await fetch(apiBaseUrl + endpoint, options);
                const data = await response.json();
                hideLoading();
                return { success: response.ok, data: data, status: response.status };
            } catch (error) {
                hideLoading();
                return { success: false, error: error.message };
            }
        }
        
        // ===== MAIN ENGINE FUNCTIONS =====
        
        // Generate Memorial Verses - MAIN ENGINE
        async function generateMemorialVerses() {
            const name = document.getElementById('memorialName').value.trim();
            if (!name) {
                displayResults('memorialVersesResults', '<div class="status error">×™×© ×œ×”×–×™×Ÿ ×©× ×¢×‘×¨×™ ×œ×–×™×›×¨×•×Ÿ</div>');
                return;
            }
            
            const result = await apiCall(`/hebrew/memorial-verses?name=${encodeURIComponent(name)}`);
            
            if (result.success) {
                displayMemorialVersesResults(result.data, 'memorialVersesResults');
            } else {
                displayResults('memorialVersesResults', 
                    `<div class="status error">×©×’×™××”: ${result.data?.detail || result.error}</div>`);
            }
        }
        
        function displayMemorialVersesResults(data, containerId) {
            let html = `
                <div class="status success">
                    ğŸ•¯ï¸ × ×•×¦×¨×• ×¤×¡×•×§×™ ×–×™×›×¨×•×Ÿ ××œ××™× ×œ×©× "${data.hebrew_name}"
                </div>
                <div class="verse-card">
                    <h4>×¡×™×›×•×:</h4>
                    <p><strong>×¡×”"×› ×¤×¡×•×§×™×:</strong> ${data.summary.total_verses}</p>
                    <p><strong>×¤×¡×•×§×™ ×”×©×:</strong> ${data.summary.name_verses_count}</p>
                    <p><strong>×¤×¡×•×§×™ × ×©××”:</strong> ${data.summary.neshama_verses_count}</p>
                    <p><strong>××•×ª×™×•×ª ×”×©×:</strong> ${data.summary.name_letters.join(', ')}</p>
                    <p><strong>××•×ª×™×•×ª ×™×™×—×•×“×™×•×ª:</strong> ${data.summary.unique_letters.join(', ')}</p>
                    <p><strong>×× ×•×¢:</strong> ${data.engine}</p>
                </div>
            `;
            
            // Display each section with all its verses
            data.sections.forEach((section, index) => {
                const sectionType = section.is_neshama ? '× ×©××”' : '×©×';
                const bgColor = section.is_neshama ? '#FFF5F5' : '#F0F9FF';
                const borderColor = section.is_neshama ? '#E74C3C' : '#2E86AB';
                
                html += `
                    <div class="verse-card" style="background: ${bgColor}; border-right-color: ${borderColor};">
                        <h4>${section.section_title}</h4>
                        <p><strong>×¡×•×’:</strong> ${sectionType} | <strong>××¡×¤×¨ ×¤×¡×•×§×™×:</strong> ${section.verse_count}</p>
                        <p><strong>××•×ª:</strong> ${section.letter.hebrew_letter} (${section.letter.hebrew_name}) - ${section.letter.english_name}</p>
                        <p><strong>×¢×¨×š ×’×™××˜×¨×™×”:</strong> ${section.letter.numeric_value} | <strong>××™×§×•× ×‘××œ×¤×‘×™×ª:</strong> ${section.letter.position}</p>
                        
                        <div style="margin-top: 15px;">
                            <h5>×›×œ ×”×¤×¡×•×§×™× ×©×œ ×”××•×ª ${section.letter.hebrew_letter}:</h5>
                `;
                
                section.verses.forEach((verse, vIndex) => {
                    html += `
                        <div class="verse-result" style="margin: 10px 0; padding: 12px; background: white; border: 1px solid #E8F4FD;">
                            <div class="verse-hebrew" style="font-size: 18px;">${verse.hebrew_text}</div>
                            <div class="verse-english" style="font-size: 14px; color: #666; margin: 8px 0;">${verse.english_text}</div>
                            <div class="verse-meta" style="font-size: 12px; color: #4A90E2;">
                                ${verse.verse_reference} | ${verse.verse_reference_english} | ×¤×¡×•×§ ${verse.verse_in_section} ×‘×§×˜×¢
                            </div>
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            });
            
            displayResults(containerId, html);
        }
        
        // Test common memorial names with main engine
        async function testCommonMemorialNames() {
            const memorialNames = ['×™×•×¡×£', '××¨×™×', '××‘×¨×”×', '×©×¨×”', '×“×•×“', '×¨×—×œ'];
            let html = '<h4>×‘×“×™×§×ª ×©××•×ª × ×¤×•×¦×™× ×‘×× ×•×¢ ×”×¨××©×™:</h4>';
            
            for (const name of memorialNames) {
                const result = await apiCall(`/hebrew/memorial-verses?name=${encodeURIComponent(name)}`);
                
                if (result.success) {
                    const data = result.data;
                    html += `
                        <div class="verse-card">
                            <h5>${name}</h5>
                            <p><strong>×¡×”"×› ×¤×¡×•×§×™×:</strong> ${data.summary.total_verses} 
                               (${data.summary.name_verses_count} ×¤×¡×•×§×™ ×©× + ${data.summary.neshama_verses_count} ×¤×¡×•×§×™ × ×©××”)</p>
                            <p><strong>××•×ª×™×•×ª:</strong> ${data.summary.unique_letters.join(', ')}</p>
                            <p><strong>×§×˜×¢×™×:</strong> ${data.sections.length}</p>
                            <span class="status success">âœ“ ×”×•×©×œ×</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="verse-card">
                            <h5>${name}</h5>
                            <span class="status error">×©×’×™××” ×‘×× ×•×¢</span>
                        </div>
                    `;
                }
            }
            
            displayResults('memorialVersesResults', html);
        }

        // Hebrew Name Analysis
        async function analyzeHebrewName() {
            const name = document.getElementById('hebrewName').value.trim();
            if (!name) {
                displayResults('nameAnalysisResults', '<div class="status error">×™×© ×œ×”×–×™×Ÿ ×©× ×¢×‘×¨×™</div>');
                return;
            }
            
            const result = await apiCall(`/hebrew/analyze-name?hebrew_name=${encodeURIComponent(name)}`, {
                method: 'POST'
            });
            
            if (result.success) {
                let html = `<div class="status success">× ×™×ª×•×— ×”×©× "${name}" ×”×•×©×œ× ×‘×”×¦×œ×—×”</div>`;
                const analysis = result.data;
                
                html += `
                    <div class="verse-card">
                        <h4>×¤×™×¨×•×˜ ×”××•×ª×™×•×ª:</h4>
                        <div class="alphabet-grid">
                `;
                
                analysis.letters.forEach(letter => {
                    html += `
                        <div class="letter-card">
                            <div class="letter-hebrew">${letter.hebrew_letter}</div>
                            <div class="letter-name">${letter.hebrew_name}</div>
                            <div class="letter-name">×¢×¨×š: ${letter.numeric_value}</div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                        <p><strong>×¡×”"×› ××•×ª×™×•×ª ×™×™×—×•×“×™×•×ª:</strong> ${analysis.unique_letters}</p>
                        <p><strong>×¢×¨×š ×’×™××˜×¨×™×” ×›×•×œ×œ:</strong> ${analysis.total_gematria_value}</p>
                        <p><strong>×¤×¡×•×§×™× ×–××™× ×™×:</strong> ${analysis.available_verses}</p>
                        <p><strong>×”×¢×¨×•×ª:</strong> ${analysis.analysis_notes}</p>
                    </div>
                `;
                
                displayResults('nameAnalysisResults', html);
            } else {
                displayResults('nameAnalysisResults', 
                    `<div class="status error">×©×’×™××”: ${result.data?.detail || result.error}</div>`);
            }
        }
        
        // Test common Hebrew names
        async function testCommonNames() {
            const commonNames = ['×™×•×¡×£', '××¨×™×', '××‘×¨×”×', '×©×¨×”', '×“×•×“', '×¨×—×œ'];
            let html = '<h4>×‘×“×™×§×ª ×©××•×ª × ×¤×•×¦×™×:</h4>';
            
            for (const name of commonNames) {
                const result = await apiCall(`/hebrew/analyze-name?hebrew_name=${encodeURIComponent(name)}`, {
                    method: 'POST'
                });
                
                if (result.success) {
                    html += `
                        <div class="verse-card">
                            <strong>${name}</strong>: 
                            ${result.data.unique_letters} ××•×ª×™×•×ª, 
                            ×’×™××˜×¨×™×” ${result.data.total_gematria_value}
                            <span class="status success">âœ“</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="verse-card">
                            <strong>${name}</strong>: <span class="status error">×©×’×™××”</span>
                        </div>
                    `;
                }
            }
            
            displayResults('nameAnalysisResults', html);
        }
        
        // Verse Selection
        async function selectVerses() {
            const name = document.getElementById('nameForVerses').value.trim();
            const versesPerLetter = document.getElementById('versesPerLetter').value;
            const method = document.getElementById('selectionMethod').value;
            const includeNeshama = document.getElementById('includeNeshama').checked;
            
            if (!name) {
                displayResults('verseSelectionResults', '<div class="status error">×™×© ×œ×”×–×™×Ÿ ×©× ×¢×‘×¨×™</div>');
                return;
            }
            
            const url = `/hebrew/name-verses?name=${encodeURIComponent(name)}&verses_per_letter=${versesPerLetter}&selection_method=${method}&include_neshama=${includeNeshama}`;
            const result = await apiCall(url);
            
            if (result.success) {
                const data = result.data;
                let html = `
                    <div class="status success">× ×‘×—×¨×• ${data.total_verses} ×¤×¡×•×§×™× ×œ×©× "${name}"</div>
                    <div class="verse-card">
                        <p><strong>×©×™×˜×ª ×‘×—×™×¨×”:</strong> ${data.selection_method}</p>
                        <p><strong>×¤×¡×•×§×™ ×©×:</strong> ${data.name_verses_count}</p>
                        <p><strong>×¤×¡×•×§×™ × ×©××”:</strong> ${data.neshama_verses_count}</p>
                    </div>
                `;
                
                data.verses.forEach(verse => {
                    const neshamaIcon = verse.is_neshama_verse ? 'âœ¨' : '';
                    html += `
                        <div class="verse-card">
                            <div class="verse-hebrew">${neshamaIcon} ${verse.hebrew_text}</div>
                            <div class="verse-english">${verse.english_text}</div>
                            <div class="verse-reference">
                                ${verse.verse_reference} | ××•×ª ${verse.letter.hebrew_letter} (${verse.letter.hebrew_name})
                            </div>
                        </div>
                    `;
                });
                
                displayResults('verseSelectionResults', html);
            } else {
                displayResults('verseSelectionResults', 
                    `<div class="status error">×©×’×™××”: ${result.data?.detail || result.error}</div>`);
            }
        }
        
        // Test multiple selection methods
        async function testMultipleMethods() {
            const name = '×“×•×“'; // Name with repeated letters
            const methods = ['balanced', 'sequential', 'random'];
            let html = `<h4>×‘×“×™×§×ª ×©×™×˜×•×ª ×‘×—×™×¨×” ×©×•× ×•×ª ×œ×©× "${name}":</h4>`;
            
            for (const method of methods) {
                const url = `/hebrew/name-verses?name=${encodeURIComponent(name)}&verses_per_letter=2&selection_method=${method}&include_neshama=false`;
                const result = await apiCall(url);
                
                if (result.success) {
                    html += `
                        <div class="verse-card">
                            <h5>×©×™×˜×”: ${method}</h5>
                            <p>× ×‘×—×¨×• ${result.data.total_verses} ×¤×¡×•×§×™×</p>
                            <div>
                    `;
                    
                    result.data.verses.slice(0, 2).forEach(verse => {
                        html += `
                            <div style="border-right: 2px solid #E8F4FD; padding: 5px; margin: 5px 0;">
                                ×¤×¡×•×§ ${verse.verse_number} (××•×ª ${verse.letter.hebrew_letter})
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                } else {
                    html += `<div class="verse-card"><strong>${method}:</strong> <span class="status error">×©×’×™××”</span></div>`;
                }
            }
            
            displayResults('verseSelectionResults', html);
        }
        
        // Hebrew Alphabet
        async function loadHebrewAlphabet() {
            const result = await apiCall('/hebrew/alphabet');
            
            if (result.success) {
                const data = result.data;
                let html = `
                    <div class="status success">${data.description}</div>
                    <p><strong>×¡×”"×› ××•×ª×™×•×ª:</strong> ${data.total_letters}</p>
                    <div class="alphabet-grid">
                `;
                
                data.letters.forEach(letter => {
                    html += `
                        <div class="letter-card">
                            <div class="letter-hebrew">${letter.hebrew_letter}</div>
                            <div class="letter-name">${letter.hebrew_name}</div>
                            <div class="letter-name">${letter.english_name}</div>
                            <div class="letter-name">×¢×¨×š: ${letter.numeric_value}</div>
                            <div class="letter-name">×©×™××•×©×™×: ${letter.usage_count}</div>
                        </div>
                    `;
                });
                
                html += '</div>';
                displayResults('alphabetResults', html);
            } else {
                displayResults('alphabetResults', 
                    `<div class="status error">×©×’×™××”: ${result.data?.detail || result.error}</div>`);
            }
        }
        
        // Hebrew Alphabet with verses
        async function loadAlphabetWithVerses() {
            const result = await apiCall('/hebrew/alphabet?include_verses=true&verses_per_letter=1');
            
            if (result.success) {
                const data = result.data;
                let html = `
                    <div class="status success">${data.description} (×¢× ×¤×¡×•×§×™× ×œ×“×•×’××”)</div>
                    <div class="alphabet-grid">
                `;
                
                data.letters.forEach(letter => {
                    html += `
                        <div class="letter-card" style="text-align: right;">
                            <div class="letter-hebrew">${letter.hebrew_letter}</div>
                            <div class="letter-name">${letter.hebrew_name}</div>
                    `;
                    
                    if (letter.verses && letter.verses.length > 0) {
                        const verse = letter.verses[0];
                        html += `
                            <div style="font-size: 12px; color: #666; margin-top: 8px; line-height: 1.3;">
                                ${verse.hebrew_text.substring(0, 30)}...
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                });
                
                html += '</div>';
                displayResults('alphabetResults', html);
            } else {
                displayResults('alphabetResults', 
                    `<div class="status error">×©×’×™××”: ${result.data?.detail || result.error}</div>`);
            }
        }
        
        // Hebrew Search
        async function searchHebrew() {
            const query = document.getElementById('searchQuery').value.trim();
            const searchType = document.getElementById('searchType').value;
            
            if (!query) {
                displayResults('searchResults', '<div class="status error">×™×© ×œ×”×–×™×Ÿ ×©××™×œ×ª×ª ×—×™×¤×•×©</div>');
                return;
            }
            
            const url = `/hebrew/search?query=${encodeURIComponent(query)}&search_type=${searchType}&limit=10`;
            const result = await apiCall(url);
            
            if (result.success) {
                const data = result.data;
                let html = `
                    <div class="status success">× ××¦××• ${data.total_results} ×ª×•×¦××•×ª ×¢×‘×•×¨ "${query}"</div>
                `;
                
                // Display verses
                if (data.results.verses && data.results.verses.length > 0) {
                    html += '<h4>×¤×¡×•×§×™×:</h4>';
                    data.results.verses.forEach(verse => {
                        html += `
                            <div class="verse-card">
                                <div class="verse-hebrew">${verse.hebrew_text}</div>
                                <div class="verse-english">${verse.english_text}</div>
                                <div class="verse-reference">
                                    ${verse.verse_reference} | ××•×ª ${verse.letter.hebrew_letter}
                                </div>
                            </div>
                        `;
                    });
                }
                
                // Display letters
                if (data.results.letters && data.results.letters.length > 0) {
                    html += '<h4>××•×ª×™×•×ª:</h4>';
                    html += '<div class="alphabet-grid">';
                    data.results.letters.forEach(letter => {
                        html += `
                            <div class="letter-card">
                                <div class="letter-hebrew">${letter.hebrew_letter}</div>
                                <div class="letter-name">${letter.hebrew_name}</div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                if (data.total_results === 0) {
                    html += '<div class="status info">×œ× × ××¦××• ×ª×•×¦××•×ª. × ×¡×” ××™×œ×ª ×—×™×¤×•×© ××—×¨×ª.</div>';
                    if (data.search_suggestions && data.search_suggestions.length > 0) {
                        html += '<h5>×”×¦×¢×•×ª:</h5><ul>';
                        data.search_suggestions.forEach(suggestion => {
                            html += `<li>${suggestion}</li>`;
                        });
                        html += '</ul>';
                    }
                }
                
                displayResults('searchResults', html);
            } else {
                displayResults('searchResults', 
                    `<div class="status error">×©×’×™××”: ${result.data?.detail || result.error}</div>`);
            }
        }
        
        // Test search samples
        async function testSearchSamples() {
            const samples = ['×ª×•×¨×”', '×××ª', '×©×œ×•×'];
            let html = '<h4>×‘×“×™×§×ª ×“×•×’×××•×ª ×—×™×¤×•×©:</h4>';
            
            for (const sample of samples) {
                const url = `/hebrew/search?query=${encodeURIComponent(sample)}&search_type=verses&limit=3`;
                const result = await apiCall(url);
                
                if (result.success) {
                    html += `
                        <div class="verse-card">
                            <strong>×—×™×¤×•×© "${sample}":</strong> 
                            ${result.data.total_results} ×ª×•×¦××•×ª
                            <span class="status success">âœ“</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="verse-card">
                            <strong>×—×™×¤×•×© "${sample}":</strong> 
                            <span class="status error">×©×’×™××”</span>
                        </div>
                    `;
                }
            }
            
            displayResults('searchResults', html);
        }
        
        // RTL Layout test
        function testRTLLayout() {
            const tests = [
                {
                    name: '×›×™×•×•×Ÿ ×˜×§×¡×˜ ×¢×‘×¨×™',
                    test: () => {
                        const elem = document.createElement('div');
                        elem.innerHTML = '×‘×“×™×§×”';
                        elem.style.direction = 'rtl';
                        return elem.style.direction === 'rtl';
                    }
                },
                {
                    name: '×¤×•× ×˜ ×¢×‘×¨×™',
                    test: () => {
                        return document.fonts.check('16px "Noto Sans Hebrew"') || true; // Always pass if font API not supported
                    }
                },
                {
                    name: '×ª××™×›×” ×‘-RTL CSS',
                    test: () => {
                        const elem = document.createElement('div');
                        elem.style.textAlign = 'right';
                        return elem.style.textAlign === 'right';
                    }
                }
            ];
            
            let html = '<h4>×ª×•×¦××•×ª ×‘×“×™×§×ª RTL:</h4>';
            
            tests.forEach(test => {
                const passed = test.test();
                html += `
                    <div class="verse-card">
                        <strong>${test.name}:</strong> 
                        <span class="status ${passed ? 'success' : 'error'}">
                            ${passed ? '×¢×•×‘×¨ âœ“' : '× ×›×©×œ âœ—'}
                        </span>
                    </div>
                `;
            });
            
            displayResults('rtlResults', html);
        }
        
        // API Health Check
        async function checkAPIHealth() {
            const endpoints = [
                { name: '×‘×¨×™××•×ª ×›×œ×œ×™×ª', url: '/health' },
                { name: '××œ×¤×‘×™×ª ×¢×‘×¨×™', url: '/hebrew/alphabet' },
                { name: '×¡×˜×˜×™×¡×˜×™×§×•×ª ×¢×‘×¨×™×•×ª', url: '/hebrew/stats' }
            ];
            
            let html = '<h4>×‘×“×™×§×ª × ×§×•×“×•×ª ×’×™×©×” ×©×œ API:</h4>';
            
            for (const endpoint of endpoints) {
                const result = await apiCall(endpoint.url);
                
                html += `
                    <div class="verse-card">
                        <strong>${endpoint.name}:</strong> 
                        <span class="status ${result.success ? 'success' : 'error'}">
                            ${result.success ? `${result.status} âœ“` : `×©×’×™××” ${result.status || '×œ× ×™×“×•×¢'} âœ—`}
                        </span>
                        ${result.success ? '' : `<br><small>${result.error || result.data?.detail}</small>`}
                    </div>
                `;
            }
            
            displayResults('apiHealthResults', html);
        }
        
        // Full API Test
        async function runFullAPITest() {
            let html = '<h4>×‘×“×™×§×” ××§×™×¤×” ×©×œ ×›×œ ×”-API:</h4>';
            
            // Test Hebrew alphabet
            const alphabetResult = await apiCall('/hebrew/alphabet');
            html += `
                <div class="verse-card">
                    <strong>××œ×¤×‘×™×ª ×¢×‘×¨×™:</strong> 
                    <span class="status ${alphabetResult.success ? 'success' : 'error'}">
                        ${alphabetResult.success ? `${alphabetResult.data?.total_letters || '×œ× ×™×“×•×¢'} ××•×ª×™×•×ª âœ“` : '× ×›×©×œ âœ—'}
                    </span>
                </div>
            `;
            
            // Test name analysis
            const nameResult = await apiCall('/hebrew/analyze-name?hebrew_name=' + encodeURIComponent('×™×•×¡×£'), {
                method: 'POST'
            });
            html += `
                <div class="verse-card">
                    <strong>× ×™×ª×•×— ×©×:</strong> 
                    <span class="status ${nameResult.success ? 'success' : 'error'}">
                        ${nameResult.success ? `× ×™×ª×— "${nameResult.data?.name || ''}" âœ“` : '× ×›×©×œ âœ—'}
                    </span>
                </div>
            `;
            
            // Test verse selection
            const versesResult = await apiCall('/hebrew/name-verses?name=' + encodeURIComponent('×™×•×¡×£') + '&verses_per_letter=1');
            html += `
                <div class="verse-card">
                    <strong>×‘×—×™×¨×ª ×¤×¡×•×§×™×:</strong> 
                    <span class="status ${versesResult.success ? 'success' : 'error'}">
                        ${versesResult.success ? `${versesResult.data?.total_verses || '0'} ×¤×¡×•×§×™× âœ“` : '× ×›×©×œ âœ—'}
                    </span>
                </div>
            `;
            
            // Test search
            const searchResult = await apiCall('/hebrew/search?query=' + encodeURIComponent('××‘×¨×”×') + '&search_type=verses&limit=5');
            html += `
                <div class="verse-card">
                    <strong>×—×™×¤×•×© ×¢×‘×¨×™:</strong> 
                    <span class="status ${searchResult.success ? 'success' : 'error'}">
                        ${searchResult.success ? `${searchResult.data?.total_results || '0'} ×ª×•×¦××•×ª âœ“` : '× ×›×©×œ âœ—'}
                    </span>
                </div>
            `;
            
            // Test stats
            const statsResult = await apiCall('/hebrew/stats');
            html += `
                <div class="verse-card">
                    <strong>×¡×˜×˜×™×¡×˜×™×§×•×ª:</strong> 
                    <span class="status ${statsResult.success ? 'success' : 'error'}">
                        ${statsResult.success ? `${statsResult.data?.total_verses || '0'} ×¤×¡×•×§×™×, ${statsResult.data?.public_memorials || '0'} ××–×›×¨×•×ª âœ“` : '× ×›×©×œ âœ—'}
                    </span>
                </div>
            `;
            
            displayResults('apiHealthResults', html);
        }
        
        // Initialize with some sample data
        document.addEventListener('DOMContentLoaded', function() {
            // Pre-fill some sample data
            document.getElementById('hebrewName').value = '×™×•×¡×£';
            document.getElementById('nameForVerses').value = '××¨×™×';
            document.getElementById('memorialName').value = '×™×•×¡×£';  // Main engine sample
            document.getElementById('searchQuery').value = '××‘×¨×”×';
        });
    </script>
</body>
</html>