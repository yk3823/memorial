{% extends "base_rtl.html" %}

{% block title %}ניהול קופונים - {% endblock %}

{% block extra_css %}
<style>
    .admin-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 0;
    }
    
    .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .btn-admin {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-admin:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        color: white;
    }
    
    .coupon-table {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .table thead th {
        background: #f8f9fa;
        border: none;
        font-weight: 600;
        color: #495057;
        padding: 1rem;
    }
    
    .table tbody tr {
        transition: background-color 0.2s ease;
    }
    
    .table tbody tr:hover {
        background-color: rgba(102, 126, 234, 0.05);
    }
    
    .table td {
        padding: 1rem;
        border: none;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
    }
    
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .status-active {
        background: #d4edda;
        color: #155724;
    }
    
    .status-used {
        background: #cce7ff;
        color: #004085;
    }
    
    .status-expired {
        background: #f8d7da;
        color: #721c24;
    }
    
    .status-revoked {
        background: #f1f1f1;
        color: #6c757d;
    }
    
    .coupon-code {
        font-family: 'Courier New', monospace;
        font-weight: 600;
        color: #667eea;
        font-size: 0.9rem;
    }
    
    .filters-section {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px 10px 0 0;
    }
    
    .form-floating > .form-control {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        transition: border-color 0.3s ease;
    }
    
    .form-floating > .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .loading-spinner {
        text-align: center;
        padding: 2rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        color: #6c757d;
    }
    
    .pagination {
        justify-content: center;
        margin-top: 2rem;
    }
    
    .pagination .page-link {
        border-radius: 10px;
        margin: 0 0.25rem;
        border: 2px solid #e9ecef;
        color: #667eea;
        font-weight: 600;
    }
    
    .pagination .page-link:hover {
        background-color: #667eea;
        border-color: #667eea;
        color: white;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #667eea;
        border-color: #667eea;
    }
    
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .action-buttons {
            justify-content: center;
        }
        
        .table-responsive {
            font-size: 0.85rem;
        }
        
        .admin-header {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="admin-header">
        <h1 class="mb-2">ניהול קופונים</h1>
        <p class="mb-0 opacity-90">ניהול קופונים לתשלומים במשרד</p>
    </div>
    
    <!-- Statistics -->
    <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
            <div class="stat-number" id="totalCoupons">-</div>
            <div class="stat-label">סה"כ קופונים</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="usedCoupons">-</div>
            <div class="stat-label">קופונים שנוצלו</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="activeCoupons">-</div>
            <div class="stat-label">קופונים פעילים</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="usageRate">-%</div>
            <div class="stat-label">אחוז ניצול</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalValue">₪-</div>
            <div class="stat-label">סה"כ ערך שנוצל</div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="action-buttons">
        <button type="button" class="btn btn-admin" data-bs-toggle="modal" data-bs-target="#createCouponModal">
            <i class="bi bi-plus-circle me-2"></i>
            יצירת קופון חדש
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="refreshData()">
            <i class="bi bi-arrow-clockwise me-2"></i>
            רענון נתונים
        </button>
        <button type="button" class="btn btn-outline-warning" onclick="cleanupExpiredCoupons()">
            <i class="bi bi-trash3 me-2"></i>
            ניקוי קופונים שפג תוקפם
        </button>
    </div>
    
    <!-- Filters -->
    <div class="filters-section">
        <h5 class="mb-3">סינון וחיפוש</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <select class="form-select" id="statusFilter" onchange="filterCoupons()">
                    <option value="">כל הסטטוסים</option>
                    <option value="active">פעיל</option>
                    <option value="used">נוצל</option>
                    <option value="expired">פג תוקף</option>
                    <option value="revoked">בוטל</option>
                </select>
            </div>
            <div class="col-md-6">
                <input type="text" class="form-control" id="customerNameFilter" 
                       placeholder="חיפוש לפי שם לקוח" onchange="filterCoupons()">
            </div>
            <div class="col-md-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includeExpired" checked onchange="filterCoupons()">
                    <label class="form-check-label" for="includeExpired">
                        כלול קופונים שפג תוקפם
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Coupons Table -->
    <div class="coupon-table">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>קוד קופון</th>
                        <th>שם לקוח</th>
                        <th>סכום</th>
                        <th>סטטוס</th>
                        <th>נוצר בתאריך</th>
                        <th>נוצל בתאריך</th>
                        <th>פעולות</th>
                    </tr>
                </thead>
                <tbody id="couponsTableBody">
                    <tr>
                        <td colspan="7" class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">טוען...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Pagination -->
    <nav aria-label="ניווט בעמודים" class="mt-4">
        <ul class="pagination" id="pagination">
            <!-- Pagination will be populated by JavaScript -->
        </ul>
    </nav>
</div>

<!-- Create Coupon Modal -->
<div class="modal fade" id="createCouponModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">יצירת קופון חדש</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createCouponForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="customerName" required>
                                <label for="customerName">שם הלקוח *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="email" class="form-control" id="customerEmail">
                                <label for="customerEmail">אימייל הלקוח (אופציונלי)</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="password" class="form-control" id="uniquePassword" required minlength="8">
                                <label for="uniquePassword">סיסמה ייחודית לקופון *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="paymentAmount" value="100.00" step="0.01" min="1" max="10000" required>
                                <label for="paymentAmount">סכום תשלום (₪) *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="officeReference">
                                <label for="officeReference">מספר קבלה/אסמכתא</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="expiresInDays" value="90" min="1" max="365" required>
                                <label for="expiresInDays">תוקף בימים *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="subscriptionMonths" value="1" min="1" max="12" required>
                                <label for="subscriptionMonths">חודשי מנוי *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="maxMemorials" value="1" min="1" max="10" required>
                                <label for="maxMemorials">מספר דפי הנצחה מותרים *</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-floating">
                                <textarea class="form-control" id="notes" style="height: 100px"></textarea>
                                <label for="notes">הערות נוספות</label>
                            </div>
                        </div>
                    </div>
                </form>
                <div id="createCouponMessage" class="mt-3" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                <button type="button" class="btn btn-admin" onclick="createCoupon()">
                    <i class="bi bi-plus-circle me-2"></i>
                    יצירת קופון
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Coupon Details Modal -->
<div class="modal fade" id="couponDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">פרטי קופון</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="couponDetailsBody">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">סגירה</button>
                <button type="button" class="btn btn-danger" id="revokeCouponBtn" onclick="revokeCoupon()" style="display: none;">
                    <i class="bi bi-x-circle me-2"></i>
                    בטל קופון
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let currentPage = 1;
    let currentFilters = {};
    let selectedCouponId = null;
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        checkAuth();
        loadStats();
        loadCoupons();
    });
    
    function checkAuth() {
        const token = localStorage.getItem('access_token');
        if (!token) {
            alert('אנא התחבר כמנהל מערכת');
            window.location.href = '/login';
            return;
        }
    }
    
    async function loadStats() {
        try {
            const response = await fetch('/v1/coupons/stats', {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success && data.stats) {
                    displayStats(data.stats);
                }
            }
        } catch (error) {
            console.error('Error loading stats:', error);
        }
    }
    
    function displayStats(stats) {
        document.getElementById('totalCoupons').textContent = stats.total_coupons || 0;
        document.getElementById('usedCoupons').textContent = stats.used_coupons || 0;
        document.getElementById('activeCoupons').textContent = stats.active_coupons || 0;
        document.getElementById('usageRate').textContent = (stats.usage_rate || 0).toFixed(1) + '%';
        document.getElementById('totalValue').textContent = '₪' + (stats.total_value_used || '0.00');
    }
    
    async function loadCoupons(page = 1) {
        try {
            const params = new URLSearchParams({
                limit: 20,
                offset: (page - 1) * 20,
                ...currentFilters
            });
            
            const response = await fetch(`/v1/coupons/list?${params}`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    displayCoupons(data.coupons);
                    updatePagination(data);
                    currentPage = page;
                }
            } else {
                throw new Error('Failed to load coupons');
            }
        } catch (error) {
            console.error('Error loading coupons:', error);
            document.getElementById('couponsTableBody').innerHTML = 
                '<tr><td colspan="7" class="empty-state">שגיאה בטעינת הקופונים</td></tr>';
        }
    }
    
    function displayCoupons(coupons) {
        const tbody = document.getElementById('couponsTableBody');
        
        if (!coupons || coupons.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="empty-state">לא נמצאו קופונים</td></tr>';
            return;
        }
        
        tbody.innerHTML = coupons.map(coupon => `
            <tr>
                <td>
                    <span class="coupon-code">${coupon.code}</span>
                </td>
                <td>${coupon.customer_name}</td>
                <td>${coupon.formatted_amount}</td>
                <td>
                    <span class="status-badge status-${coupon.status}">
                        ${coupon.display_status}
                    </span>
                </td>
                <td>${formatDate(coupon.created_at)}</td>
                <td>${coupon.used_at ? formatDate(coupon.used_at) : '-'}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="viewCouponDetails('${coupon.id}')">
                        <i class="bi bi-eye"></i>
                    </button>
                    ${coupon.status === 'active' ? 
                        `<button class="btn btn-sm btn-outline-danger ms-1" onclick="showRevokeCoupon('${coupon.id}')">
                            <i class="bi bi-x-circle"></i>
                        </button>` : ''
                    }
                </td>
            </tr>
        `).join('');
    }
    
    function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('he-IL', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    }
    
    function updatePagination(data) {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(data.total_count / 20);
        
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }
        
        let paginationHTML = '';
        
        // Previous button
        paginationHTML += `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="loadCoupons(${currentPage - 1})">קודם</a>
            </li>
        `;
        
        // Page numbers
        for (let i = 1; i <= Math.min(totalPages, 5); i++) {
            paginationHTML += `
                <li class="page-item ${currentPage === i ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="loadCoupons(${i})">${i}</a>
                </li>
            `;
        }
        
        // Next button
        paginationHTML += `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="loadCoupons(${currentPage + 1})">הבא</a>
            </li>
        `;
        
        pagination.innerHTML = paginationHTML;
    }
    
    function filterCoupons() {
        currentFilters = {};
        
        const statusFilter = document.getElementById('statusFilter').value;
        const customerNameFilter = document.getElementById('customerNameFilter').value.trim();
        const includeExpired = document.getElementById('includeExpired').checked;
        
        if (statusFilter) currentFilters.status_filter = statusFilter;
        if (customerNameFilter) currentFilters.customer_name = customerNameFilter;
        if (!includeExpired) currentFilters.include_expired = false;
        
        loadCoupons(1);
    }
    
    function refreshData() {
        loadStats();
        loadCoupons(currentPage);
    }
    
    async function createCoupon() {
        try {
            const formData = {
                customer_name: document.getElementById('customerName').value.trim(),
                customer_email: document.getElementById('customerEmail').value.trim() || null,
                unique_password: document.getElementById('uniquePassword').value.trim(),
                payment_amount: parseFloat(document.getElementById('paymentAmount').value),
                office_payment_reference: document.getElementById('officeReference').value.trim() || null,
                expires_in_days: parseInt(document.getElementById('expiresInDays').value),
                subscription_months: parseInt(document.getElementById('subscriptionMonths').value),
                max_memorials_granted: parseInt(document.getElementById('maxMemorials').value),
                notes: document.getElementById('notes').value.trim() || null
            };
            
            const messageDiv = document.getElementById('createCouponMessage');
            
            // Validation
            if (!formData.customer_name || !formData.unique_password) {
                showMessage('אנא מלא את כל השדות החובה', 'danger', messageDiv);
                return;
            }
            
            if (formData.unique_password.length < 8) {
                showMessage('הסיסמה חייבת להיות באורך של לפחות 8 תווים', 'danger', messageDiv);
                return;
            }
            
            const response = await fetch('/v1/coupons/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            
            if (result.success) {
                showMessage(`קופון נוצר בהצלחה! קוד הקופון: ${result.coupon.code}`, 'success', messageDiv);
                
                // Clear form
                document.getElementById('createCouponForm').reset();
                
                // Refresh data
                setTimeout(() => {
                    refreshData();
                    bootstrap.Modal.getInstance(document.getElementById('createCouponModal')).hide();
                }, 2000);
            } else {
                showMessage(result.message || 'שגיאה ביצירת הקופון', 'danger', messageDiv);
            }
            
        } catch (error) {
            console.error('Error creating coupon:', error);
            showMessage('שגיאה ביצירת הקופון', 'danger', document.getElementById('createCouponMessage'));
        }
    }
    
    async function viewCouponDetails(couponId) {
        try {
            const response = await fetch(`/v1/coupons/${couponId}`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success && data.coupon) {
                    displayCouponDetails(data.coupon);
                    selectedCouponId = couponId;
                }
            }
        } catch (error) {
            console.error('Error loading coupon details:', error);
        }
    }
    
    function displayCouponDetails(coupon) {
        const detailsBody = document.getElementById('couponDetailsBody');
        const revokeBtn = document.getElementById('revokeCouponBtn');
        
        detailsBody.innerHTML = `
            <div class="row g-3">
                <div class="col-md-6">
                    <strong>קוד קופון:</strong><br>
                    <span class="coupon-code">${coupon.code}</span>
                </div>
                <div class="col-md-6">
                    <strong>שם לקוח:</strong><br>
                    ${coupon.customer_name}
                </div>
                <div class="col-md-6">
                    <strong>אימייל לקוח:</strong><br>
                    ${coupon.customer_email || 'לא סופק'}
                </div>
                <div class="col-md-6">
                    <strong>סכום תשלום:</strong><br>
                    ${coupon.formatted_amount}
                </div>
                <div class="col-md-6">
                    <strong>סטטוס:</strong><br>
                    <span class="status-badge status-${coupon.status}">
                        ${coupon.display_status}
                    </span>
                </div>
                <div class="col-md-6">
                    <strong>נוצר בתאריך:</strong><br>
                    ${formatDate(coupon.created_at)}
                </div>
                <div class="col-md-6">
                    <strong>נוצל בתאריך:</strong><br>
                    ${coupon.used_at ? formatDate(coupon.used_at) : 'לא נוצל'}
                </div>
                <div class="col-md-6">
                    <strong>פג תוקף:</strong><br>
                    ${coupon.expires_at ? formatDate(coupon.expires_at) : 'ללא תאריך פוגה'}
                </div>
                <div class="col-md-6">
                    <strong>חודשי מנוי:</strong><br>
                    ${coupon.subscription_months}
                </div>
                <div class="col-md-6">
                    <strong>דפי הנצחה מותרים:</strong><br>
                    ${coupon.max_memorials_granted}
                </div>
                <div class="col-md-6">
                    <strong>אסמכתא משרדית:</strong><br>
                    ${coupon.office_payment_reference || 'לא סופק'}
                </div>
                <div class="col-12">
                    <strong>הערות:</strong><br>
                    ${coupon.notes || 'ללא הערות'}
                </div>
            </div>
        `;
        
        // Show revoke button only for active coupons
        revokeBtn.style.display = coupon.status === 'active' ? 'inline-block' : 'none';
        
        new bootstrap.Modal(document.getElementById('couponDetailsModal')).show();
    }
    
    function showRevokeCoupon(couponId) {
        selectedCouponId = couponId;
        viewCouponDetails(couponId);
    }
    
    async function revokeCoupon() {
        if (!selectedCouponId) return;
        
        const reason = prompt('אנא הזן סיבה לביטול הקופון:');
        if (!reason || !reason.trim()) {
            alert('חובה להזין סיבה לביטול');
            return;
        }
        
        try {
            const response = await fetch(`/v1/coupons/${selectedCouponId}/revoke`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify({ reason: reason.trim() })
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert('הקופון בוטל בהצלחה');
                bootstrap.Modal.getInstance(document.getElementById('couponDetailsModal')).hide();
                refreshData();
            } else {
                alert('שגיאה בביטול הקופון: ' + (result.message || 'שגיאה לא ידועה'));
            }
            
        } catch (error) {
            console.error('Error revoking coupon:', error);
            alert('שגיאה בביטול הקופון');
        }
    }
    
    async function cleanupExpiredCoupons() {
        if (!confirm('האם אתה בטוח שברצונך לנקות קופונים שפג תוקפם?')) {
            return;
        }
        
        try {
            const response = await fetch('/v1/coupons/cleanup-expired', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert(result.message);
                refreshData();
            } else {
                alert('שגיאה בניקוי קופונים: ' + (result.message || 'שגיאה לא ידועה'));
            }
            
        } catch (error) {
            console.error('Error cleaning up coupons:', error);
            alert('שגיאה בניקוי קופונים');
        }
    }
    
    function showMessage(message, type, element) {
        const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
        element.innerHTML = `<div class="alert ${alertClass}" role="alert">${message}</div>`;
        element.style.display = 'block';
        
        // Auto-hide success messages
        if (type === 'success') {
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
    }
</script>
{% endblock %}